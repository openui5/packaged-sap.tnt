<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>QUnit page for sap.tnt.ToolHeader</title>
	<script src="../shared-config.js"></script>
	<script id="sap-ui-bootstrap"
			data-sap-ui-noConflict="true"
			data-sap-ui-libs="sap.m, sap.tnt" src="../../../../resources/sap-ui-core.js">
	</script>

	<link rel="stylesheet" type="text/css" media="screen"
		  href="../../../../resources/sap/ui/thirdparty/qunit.css"/>

	<script src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
	<script src="../../../../resources/sap/ui/thirdparty/sinon.js"></script>
	<script src="../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>
	<script src="../../../../resources/sap/ui/qunit/qunit-coverage.js"></script>
	<script src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
	<script>
		sinon.config.useFakeTimers = true;

		//create JSON model instance
		var oModel = new sap.ui.model.json.JSONModel();


		// create and add app
		var oApp = new sap.m.App("myApp", {initialPage: "toolHeaderPage"});
		oApp.placeAt("qunit-fixture");

		var oPage = new sap.m.Page("toolHeaderPage", {
			title: "Tool Header"
		});
		oApp.addPage(oPage);

		function getToolHeader() {
			return new sap.tnt.ToolHeader({
				content: [
					new sap.m.Button({
						icon: 'sap-icon://menu2',
						type: sap.m.ButtonType.Transparent,
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.NeverOverflow
						})
					}),
					new sap.m.ToolbarSpacer({
						width: '20px'
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "File",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "Edit",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "Edit",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "Edit",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "Edit",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "Edit",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "Edit",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "View",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "Navigate",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "Code",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.Low
						})
					}),
					new sap.tnt.ToolHeaderUtilitySeparator({
					}),
					new sap.m.ToolbarSpacer({
						layoutData : new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.NeverOverflow,
							minWidth: "20px"
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						text: "User Name",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.NeverOverflow
						})
					}),
					new sap.m.Button({
						type: sap.m.ButtonType.Transparent,
						icon: "sap-icon://log",
						press: function() {

						},
						layoutData: new sap.m.OverflowToolbarLayoutData({
							priority: sap.m.OverflowToolbarPriority.NeverOverflow
						})
					})
				]
			});
		}

		QUnit.module("API and Rendering", {
			beforeEach: function () {
				this.toolHeader = getToolHeader();
				oPage.addContent(this.toolHeader);

				sap.ui.getCore().applyChanges();
			},
			afterEach: function () {
				this.toolHeader.destroy();
				this.toolHeader = null;
			}
		});

		QUnit.test("rendered", function (assert) {
			assert.strictEqual(this.toolHeader.$().length, 1, "should render");
		});

		QUnit.test("created", function (assert) {
			assert.ok(sap.ui.getCore().byId(this.toolHeader.getId()), "created");
		});

		QUnit.test("contains elements and classes", function (assert) {
			assert.ok(this.toolHeader.$().hasClass('sapTntToolHeader'), "sapTntToolHeader class is set");
		});

		QUnit.test("overflow button", function (assert) {

			var overflowButton = this.toolHeader.$('overflowButton');
			assert.ok(overflowButton.length > 0, "Overflow button is rendered");
		});

		QUnit.test("overflow popover", function (assert) {
			assert.ok(jQuery('.sapMOTAPopover').length == 0, "Popover is not rendered");


			var overflowButton = this.toolHeader.$('overflowButton');
			overflowButton.trigger('tap');

			assert.ok(jQuery('.sapMOTAPopover').length > 0, "Popover is rendered");
		});


		QUnit.module("ToolHeader with IconTabHeader", {
			beforeEach: function () {

				this.isDesktop = sap.ui.Device.system.desktop;
				sap.ui.Device.system.desktop = false;

				var tabItems = [];
				for (var i = 0; i < 30; i++) {
					tabItems.push(new sap.m.IconTabFilter({
						key: i.toString(),
						text : 'Tab ' + i
					}));
				}

				var iconTabHeader = new sap.m.IconTabHeader({
					showOverflowSelectList: true,
					items: tabItems,
					selectedKey : 'invalidKey',
					layoutData: new sap.m.OverflowToolbarLayoutData({
						priority : sap.m.OverflowToolbarPriority.NeverOverflow,
						shrinkable: true
					})
				});

				var toolHeader = new sap.tnt.ToolHeader({
					content: [
						iconTabHeader
					]
				});

				this.iconTabHeader = iconTabHeader;
				this.toolHeader = toolHeader;

				oPage.addContent(toolHeader);

				sap.ui.getCore().applyChanges();
			},
			afterEach: function () {

				sap.ui.Device.system.desktop = this.isDesktop;

				this.toolHeader.destroy();
				this.toolHeader = null;
			}
		});

		QUnit.test("Tabs visibility", function (assert) {
			this.iconTabHeader.$().width('300px');
			this.iconTabHeader._afterIscroll();
			sap.ui.getCore().applyChanges();

			assert.ok(this.iconTabHeader.$().find('.sapMITBFilterHidden').length > 0, 'Some tabs are hidden');
		});


	</script>
</head>
<body class="sapUiBody">
<div id="qunit"></div>
<div id="qunit-fixture" style="width: 300px">test markup, will be hidden</div>
</body>
</html>
